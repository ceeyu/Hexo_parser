# S3 部署路徑修復說明

## 問題描述

`hexo-deployer-aws-s3` 插件在 Windows 系統上存在路徑分隔符問題：
- 上傳時使用反斜線 `\` 而不是正斜線 `/`
- 導致 S3 上的文件路徑錯誤（例如：`page\2\index.html` 而不是 `page/2/index.html`）
- 結果：除了首頁以外的所有頁面都顯示 404

## 解決方案

### 方案 1：修改 Permalink 格式（已採用）

修改 `_config.yml` 中的 permalink 設置：

```yaml
permalink: :title.html
```

這樣所有文章都生成為單層 HTML 文件，避免深層目錄結構。

**優點：**
- 簡單直接
- 不需要額外工具
- URL 更簡潔

**缺點：**
- URL 結構改變
- 所有文章在同一層級

### 方案 2：使用 AWS CLI 部署（推薦）

1. 安裝 AWS CLI：https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html

2. 配置 AWS 憑證：
```bash
aws configure
```

3. 使用提供的部署腳本：
```bash
tools\部署到S3.cmd
```

該腳本會：
- 清理舊文件
- 生成靜態文件
- 使用 `aws s3 sync` 正確上傳（自動處理路徑分隔符）

**優點：**
- 路徑處理正確
- 支持增量同步
- 可以保留原有的 URL 結構

**缺點：**
- 需要安裝 AWS CLI

### 方案 3：使用 CloudFront（最佳方案）

CloudFront 可以配置默認根對象，解決 S3 子目錄索引問題。

配置步驟：
1. 創建 CloudFront Distribution
2. 設置 Origin 為 S3 Bucket
3. 配置 Default Root Object 為 `index.html`
4. 設置 Custom Error Response：404 -> /index.html

**優點：**
- CDN 加速
- 支持 HTTPS
- 完美支持 SPA 路由
- 解決所有路徑問題

**缺點：**
- 配置較複雜
- 有額外費用（但通常很便宜）

## 當前狀態

- ✅ 已修改 permalink 為 `:title.html`
- ✅ 文章頁面可以正常訪問
- ⚠️ 分頁和歸檔頁面仍使用目錄結構（需要 AWS CLI 或 CloudFront）

## 測試結果

- 首頁：✅ http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/
- 文章頁：✅ http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/2025-12-25-day1-架設開發環境.html
- 分頁：❌ http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/page/2/ (需要 AWS CLI 或 CloudFront)

## 下一步

建議安裝 AWS CLI 並使用 `tools\部署到S3.cmd` 腳本進行部署，這樣可以保留完整的目錄結構並正確處理所有路徑。
