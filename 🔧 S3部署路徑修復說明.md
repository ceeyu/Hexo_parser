# S3 部署路徑修復說明

## ✅ 問題已解決！

使用自定義 Node.js 部署腳本完全解決了 Windows 路徑分隔符問題。

## 問題描述

`hexo-deployer-aws-s3` 插件在 Windows 系統上存在路徑分隔符問題：
- 上傳時使用反斜線 `\` 而不是正斜線 `/`
- 導致 S3 上的文件路徑錯誤（例如：`page\2\index.html` 而不是 `page/2/index.html`）
- 結果：除了首頁以外的所有頁面都顯示 404

## 最終解決方案

創建了自定義 Node.js 部署腳本 `tools/deploy-to-s3.js`，使用 AWS SDK 直接上傳文件。

### 特點：
- ✅ 自動處理路徑分隔符（將 `\` 轉換為 `/`）
- ✅ 自動設置正確的 Content-Type
- ✅ 支持清空 Bucket 後重新上傳
- ✅ 顯示上傳進度
- ✅ 不依賴 AWS CLI

### 使用方法：

```bash
# 完整部署（清理 + 生成 + 上傳）
npm run deploy:full

# 僅上傳（需要先 build）
npm run deploy:s3
```

## 配置要求

確保已配置 AWS 憑證（`~/.aws/credentials`）：

```ini
[default]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
```

## 測試結果

✅ 所有頁面都正常訪問：
- 首頁：http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/
- 文章頁：http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/2025-12-25-day1-架設開發環境.html
- 分頁：http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/page/2/
- 歸檔：http://xian-hexo-blog-2025.s3-website-ap-northeast-1.amazonaws.com/archives/

## 技術細節

腳本使用 `@aws-sdk/client-s3` 和 `mime-types` 套件：
- 遞歸掃描 `public` 目錄
- 使用 `path.relative()` 和 `.replace(/\\/g, '/')` 確保正確的 S3 key
- 自動偵測文件類型並設置 Content-Type
- 依賴 Bucket Policy 而不是 ACL 來設置公開訪問

## 其他方案（已棄用）

### 方案 1：修改 Permalink 格式
修改為單層 HTML 結構，但會改變 URL 結構。

### 方案 2：使用 AWS CLI
需要額外安裝 AWS CLI。

### 方案 3：使用 CloudFront
最佳方案但配置較複雜，適合生產環境。

