# 🔧 文章格式問題修復說明

## 問題總結

批量爬取時遇到兩個主要問題：

### 問題 1：刪除線顯示錯誤 ❌

**現象**：
文字中間出現橫線（刪除線），例如：
- `1~4` 顯示為 ~~1~4~~
- `1~13` 顯示為 ~~1~13~~

**原因**：
Markdown 中 `~~文字~~` 會被解析為刪除線。當文章內容包含 `1~4` 這樣的範圍表示時，會被誤判。

**解決方案**：
轉義波浪號：`1~4` → `1\~4`

### 問題 2：YAML 解析錯誤 ❌

**現象**：
```
YAMLException: bad indentation of a mapping entry
title: 標題: 副標題
```

**原因**：
YAML front-matter 中，標題包含冒號 `:` 會導致解析錯誤。

**解決方案**：
1. 用引號包圍標題：`title: "標題: 副標題"`
2. 或將英文冒號改為中文冒號：`title: 標題：副標題`

## ✅ 已修復

運行修復腳本後：
- ✅ 修復了 21 篇文章
- ✅ 70 篇無需修復
- ✅ 0 篇錯誤

## 🔧 修復工具

### 1. 自動修復腳本

```cmd
node tools/修復文章格式.js
```

功能：
- 自動為包含冒號的標題添加引號
- 自動轉義內容中的 `數字~數字` 格式
- 批量處理所有文章

### 2. 改進的爬蟲

`tools/批量爬取系列文章.js` 已更新：
- ✅ 自動處理標題中的冒號
- ✅ 自動轉義內容中的波浪號
- ✅ 清理多餘空行

## 📋 使用流程

### 新文章爬取

```cmd
# 1. 批量爬取（已包含修復邏輯）
node tools/批量爬取系列文章.js

# 2. 預覽
npm run server

# 3. 部署
npm run clean && npm run build && npm run deploy
```

### 修復已存在的文章

```cmd
# 1. 運行修復腳本
node tools/修復文章格式.js

# 2. 預覽檢查
npm run server

# 3. 確認無誤後部署
npm run clean && npm run build && npm run deploy
```

## 🎯 檢查清單

部署前確認：

- [ ] 運行 `npm run server` 無錯誤
- [ ] 瀏覽器訪問 http://localhost:4000 正常
- [ ] 文章標題正確顯示
- [ ] 文章內容無刪除線
- [ ] 代碼塊格式正確
- [ ] 圖片正常顯示

## 🔍 手動檢查方法

### 檢查 YAML 錯誤

如果還有 YAML 錯誤，查看錯誤訊息中的文件名：

```
ERROR Process failed: _posts/文章名.md
YAMLException: bad indentation...
```

手動編輯該文件，為標題添加引號：

```yaml
# 錯誤
title: 標題: 副標題

# 正確
title: "標題: 副標題"
```

### 檢查刪除線問題

搜索文章中的波浪號：

```cmd
# Windows
findstr /s "~" source\_posts\*.md
```

手動添加反斜杠轉義：
```markdown
# 錯誤
產生1~4的亂數

# 正確
產生1\~4的亂數
```

## 💡 預防措施

### 未來爬取時

爬蟲已更新，會自動處理這些問題。但如果手動創建文章：

1. **標題包含冒號**：用引號包圍
   ```yaml
   title: "我的標題: 副標題"
   ```

2. **內容包含範圍**：轉義波浪號
   ```markdown
   數字範圍 1\~10
   ```

3. **特殊字符**：注意 YAML 保留字符
   - `:` 冒號
   - `#` 井號
   - `&` 和號
   - `*` 星號
   - `!` 驚嘆號
   - `|` 管道符
   - `>` 大於號
   - `'` 單引號
   - `"` 雙引號
   - `%` 百分號
   - `@` at 符號
   - `` ` `` 反引號

## 🆘 常見問題

### Q: 修復後還是有錯誤？

A: 
1. 檢查錯誤訊息中的具體文件
2. 手動打開該文件檢查
3. 確認 front-matter 格式正確
4. 運行 `npm run clean` 清理緩存

### Q: 刪除線還是出現？

A: 
1. 確認已運行修復腳本
2. 檢查文件是否真的被修改
3. 清理緩存重新生成

### Q: 如何批量檢查所有文章？

A:
```cmd
# 檢查 YAML 錯誤
npm run server

# 查看所有包含波浪號的文章
findstr /s "~" source\_posts\*.md
```

## 📊 統計信息

### 本次修復

- 總文章數：91 篇
- 已修復：21 篇
- 無需修復：70 篇
- 錯誤：0 篇

### 修復類型

- YAML 冒號問題：7 篇
- 刪除線問題：14 篇
- 兩者都有：部分文章

## 🎉 完成

現在所有文章都已修復！可以正常預覽和部署了。

```cmd
npm run server
```

訪問 http://localhost:4000 確認一切正常！🚀
